---
description: 关注速报功能实现规范
globs:
  - "apps/web/app/(focus-bulletin)/**"
alwaysApply: true
---

# Oak Research - 关注速报功能规范

本规则基于 Figma 原型设计，定义 **关注速报** 模块的页面布局、交互逻辑、组件使用方式。

## 1. 功能结构

关注速报包含两个核心子模块：

1. **关注设置 (config/)**

   - 用于配置用户关注的关键词、分类、平台、站点、搜索引擎、代理、AI 等。
   - 以表格 + 表单为主，支持搜索、添加、删除、修改。

2. **关注内容 (page.tsx)**
   - 展示系统获取的情报内容，支持快速筛选和收藏。
   - 以卡片形式展示 AI 处理后的摘要信息。

## 2. 路由规范

```
apps/web/app/(focus-bulletin)/
├── layout.tsx             # 子布局：左侧侧边栏 + 右侧内容
├── page.tsx               # 默认进入“关注内容”
└── config/
├── page.tsx           # 关注设置首页
├── keywords/          # 关键词设置
│   └── page.tsx
├── categories/        # 分类设置
│   └── page.tsx
├── platforms/         # 平台设置
│   └── page.tsx
├── sites/             # 站点设置
│   └── page.tsx
├── search-engines/    # 搜索引擎设置
│   └── page.tsx
├── proxies/           # 代理设置
│   └── page.tsx
├── ai/                # AI 设置
│   └── page.tsx
└── misc/              # 杂项设置
└── page.tsx

```

## 3. 关注设置布局规范

- **左侧导航栏**（固定在 `config/layout.tsx`）：

  - 菜单项：关键词设置、分类设置、关注平台、关注站点、搜索引擎、代理、AI 设置、杂项设置
  - 当前选中项高亮

- **右侧内容区**：
  - 顶部：标题（如“关键词设置”）+ 操作按钮（添加、搜索）
  - 中部：Shadcn `<Table />`
    - 表格列：根据子模块不同定义，如：
      - 关键词设置：关键词 ID、名称、分类、关键词派生、操作
      - 分类设置：分类 ID、名称、关键词数量、操作
      - 平台设置：平台 ID、名称、描述、网络环境、操作
  - 底部：分页器（统一样式）

## 4. 关注内容布局规范

- **卡片列表（Grid）**

  - 栅格：`grid grid-cols-3 gap-4`（大屏 3 列，中屏 2 列，小屏 1 列）
  - 卡片内容（使用 `packages/ui/card/FocusCard.tsx`）：
    - 标题（如文章标题 / 平台名）
    - 标签区：相关人物、组织（Shadcn `<Badge />`）
    - 摘要（Markdown 渲染，限制高度，超出显示 “展开”）
    - 信息栏（底部）：
      - 时间（文章时间/爬取时间）
      - 来源平台
      - 类型（网页 / 客户端 / 暗网）
    - 收藏按钮：右上角 `<Button variant="ghost" size="icon">`，点击加入收藏夹

- **详情页（抽屉或对话框形式）**
  - 内容区域：完整 Markdown 渲染
  - 底部：原始链接、截图、Refer 信息
  - 顶部：收藏按钮

## 5. 数据交互逻辑

### 5.1 数据获取

- 使用 **SWR** 获取数据，统一 fetcher：
  ```ts
  const { data, error, isLoading } = useSWR("/api/focus-bulletin/content");
  ```

* 关注设置的表格数据分页获取：

  - `/api/focus-bulletin/config/keywords?page=1&limit=20`
  - 后端返回 `{ data, total, page, limit }`

### 5.2 自动更新

- 系统会按照用户设置的频率定时抓取内容。
- 前端刷新依赖 SWR 的 `mutate` 机制，不用手动刷新。

### 5.3 收藏功能

- API: `POST /api/focus-bulletin/favorites`
- 请求体：`{ contentId: string }`
- 成功后 toast 提示，并触发收藏夹更新。

## 6. 表单与校验

- **所有表单**必须基于：

  - React Hook Form
  - Zod 校验 Schema

- 表单控件统一从 `packages/ui/form/` 引入，保持一致性。

示例（关键词添加表单）：

```tsx
<Form>
  <FormField name="keyword" control={form.control}>
    <Input placeholder="请输入关键词" />
  </FormField>
  <FormField name="category" control={form.control}>
    <Select options={categories} />
  </FormField>
  <Button type="submit">保存</Button>
</Form>
```

## 7. UI 组件规范

- **FocusCard** → 关注内容卡片
- **ConfigTable** → 表格封装组件，内置分页、搜索
- **MarkdownRenderer** → 用于展示摘要和详情（来自 `packages/ui/markdown`）
- **收藏按钮** → 统一用 `BookmarkIcon`（lucide-react）

## 8. 响应式要求

- 卡片列表在 `lg` 屏幕显示 3 列，`md` 屏幕 2 列，`sm` 屏幕 1 列
- 配置表格在小屏幕自动折叠为卡片形式

## 9. 开发约束

- 关注设置的 CRUD 操作必须走 API，不允许写在前端 mock。
- 表格组件禁止直接用 `<table>`，必须使用 Shadcn UI 封装。
- 关注内容摘要渲染时，超出部分统一用 `line-clamp-3` 截断。
- 收藏操作必须乐观更新（UI 先变更，再刷新数据）。
