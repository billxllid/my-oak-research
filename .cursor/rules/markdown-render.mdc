---
description: Markdown 渲染与交互规范
globs:
  - "packages/ui/markdown/**"
  - "apps/web/app/**"
alwaysApply: true
---

# Oak Research - Markdown 渲染与交互规范

本规范统一系统中 Markdown 内容的渲染方式，包括新闻摘要、收藏内容、报告正文。

## 1. 渲染库

- 使用 `react-markdown` 作为基础渲染库
- 结合 `remark-gfm` 支持表格/任务列表/脚注
- 结合 `rehype-highlight` 支持代码高亮
- 渲染器封装在 `packages/ui/markdown/MarkdownRenderer.tsx`

## 2. 基本要求

- 所有 Markdown 内容必须通过 `<MarkdownRenderer>` 渲染
- 禁止直接在页面内使用 `react-markdown`
- 支持暗色模式与浅色模式
- 支持安全链接（所有外链 `rel="noopener noreferrer" target="_blank"`）

## 3. 组件结构

`MarkdownRenderer` props：

```ts
interface MarkdownRendererProps {
  content: string; // Markdown 内容
  className?: string; // 外层样式
  clampLines?: number; // 可选：折叠行数
  collapsible?: boolean; // 是否支持展开/折叠
}
```

内部实现：

- 使用 `line-clamp` 实现摘要折叠
- 展开按钮样式统一：`<Button variant="link" size="sm">展开/收起</Button>`

## 4. 安全与清洗

- 禁止渲染 `<script>`、`<iframe>`、`<style>` 等危险标签
- 链接 URL 必须通过 `safe-url` 过滤
- 对于未知协议（如 `javascript:`），渲染为纯文本

## 5. 样式规范

- 标题：h1–h6 使用 Tailwind Typography 风格
- 段落：`leading-relaxed text-sm md:text-base`
- 引用：左侧竖线 + 灰色背景
- 代码块：`<pre>` 带行号 + 复制按钮
- 表格：Shadcn `<Table>` 风格

## 6. 交互规范

- 链接：点击外链自动新窗口打开
- 图片：点击可放大预览（统一用 `<ImagePreview>`）
- 摘要模式：默认展示前 3 行，点击“展开”显示全文
- 支持内联引用跳转（脚注点击可跳到底部 Refer）

## 7. 使用场景

- **关注速报** → 摘要模式（3 行折叠）
- **收藏夹详情** → 完整渲染，带 Refer 信息
- **报告编写** → Markdown 编辑器输出，实时渲染
- **知识库上传预览** → 仅预览，不支持折叠

## 8. Markdown 编辑器

- 使用 `@uiw/react-md-editor` 或 `tiptap-markdown`，封装为 `<MarkdownEditor>`
- 编辑器支持：标题/粗体/列表/引用/代码块
- 右侧预览区使用 `MarkdownRenderer`

## 9. 开发约束

- 禁止前端自行拼接 HTML，必须通过 `MarkdownRenderer`
- Cursor 在生成页面详情时必须提示：正文请用 `<MarkdownRenderer content={...} />`
- 长文必须支持折叠，避免撑爆页面
